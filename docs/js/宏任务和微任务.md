# 宏任务和微任务

JavaScript 是一个单线程的脚本语言。所以就是说在一行代码执行的过程中，必然不会存在同时执行的另一行代码。

在当前的微任务没有执行完成时，是不会执行下一个宏任务的。

宏任务必然是在微任务之后才执行的（因为微任务实际上是宏任务的其中一个步骤）

## 宏任务

其实就是个回调队列

| #                     | 浏览器 | node |
| --------------------- | ------ | ---- |
| I/O                   | ✅     | ✅   |
| setTimeout            | ✅     | ✅   |
| setInterval           | ✅     | ✅   |
| setImmediate          | ❌     | ✅   |
| requestAnimationFrame | ✅     | ❌   |

## 微任务

是一个任务队列，这个队列的执行顺序是在清空执行栈之后

| #                          | 浏览器 | node |
| -------------------------- | ------ | ---- |
| process.nextTick           | ❌     | ✅   |
| MutationObserver           | ✅     | ❌   |
| Promise.then catch finally | ✅     | ✅   |

## Event Loop

- 每办理完一个业务，柜员就会问当前的客户，是否还有其他需要办理的业务。（**检查还有没有微任务需要处理**）
- 而客户明确告知说没有事情以后，柜员就去查看后边还有没有等着办理业务的人。（**结束本次宏任务、检查还有没有宏任务需要处理**）
- 这个检查的过程是持续进行的，每完成一个任务都会进行一次，而这样的操作就被称为 `Event Loop`。
